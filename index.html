<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="apple-touch-icon" sizes="180x180" href="serieA16">
  <link rel="icon" type="image/png" sizes="32x32" href="serieA16">
  <link rel="icon" type="image/png" sizes="16x16" href="serieA16">
  <title>Serie B</title>

  <style>
    :root {
      --bg:#0f1724;
      --card:#0b1220;
      --accent:#0ea5a4;
      --muted:#94a3b8;
      --danger:#ef4444;
    }
    *{ box-sizing:border-box; font-family:Inter,Segoe UI,Roboto,Arial }
    body{
      margin:0;
      background:#071024;
      color:#e6f0fa;
      padding:14px;
    }
    .wrap{
      background:rgba(255,255,255,0.03);
      border-radius:12px;
      padding:12px;
      max-width:900px;
      margin:auto;
    }
    h1{
      margin:0 0 40px;
      font-size:20px;
      text-align:center;
    }
    .topbar{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      justify-content:center;
      margin-bottom:12px;
    }
    button{
      background:var(--accent);
      border:none;
      color:#042;
      padding:8px 10px;
      border-radius:8px;
      cursor:pointer;
      font-weight:600;
      transition:.2s;
      font-size:14px;
    }
    button.secondary{
      background:transparent;
      color:var(--accent);
      border:1px solid rgba(255,255,255,0.1);
    }
    button.danger{
      background:var(--danger);
      color:white;
    }
    table{
      width:100%;
      border-collapse:collapse;
      table-layout:fixed;
      font-size:15px;
    }
    th,td{
      padding:6px 4px;
      text-align:center;
      border-bottom:1px solid rgba(255,255,255,0.05);
      word-wrap:break-word;
    }
    td.editable{ cursor:pointer }
    tr.selected{ background:rgba(14,165,164,0.1) }
    .top1{ background:rgba(0, 255, 94, 0.49) !important }
    .bottom2{ background:rgba(255, 0, 0, 0.341) !important }

    img{
      width: 40px;
      margin: 0px 0px -14px 0px;
    }
    .nome{
      width: 100px;
    }
    .pts{
      width: 40px;
    }
    .pos{
      width: 38px;
    }
  </style>
</head>

<body>

  <div class="wrap">
    <h1>Classificação <img src="serieA.png" alt=""></h1>

    <div class="topbar">
      <button id="addBtn">Inserir</button>
      <button id="delBtn" class="secondary">Excluir</button>
      <button id="resetPointsBtn" class="secondary">Resetar Pontos</button>
      <button id="exportPdfBtn">PDF</button>
      <button id="clearBtn" class="danger secondary">Limpar</button>
    </div>

    <table id="table">
      <thead>
        <tr>
          <th class="pos">POS</th>
          <th class="nome">NOME</th>
          <th class="pts">PTS</th>
          <th>J</th>
          <th>V</th>
          <th>E</th>
          <th>D</th>
          <th>G</th>
          <th>S</th>
          <th>S</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <footer></footer>
  </div>

  <!-- jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <!-- AutoTable -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

  <script>
    const STORAGE_KEY="Serie_A";
    const tbody=document.querySelector("#table tbody");
    const byId=id=>document.getElementById(id);

    const loadData=()=>JSON.parse(localStorage.getItem(STORAGE_KEY)||"[]");
    const saveData=d=>localStorage.setItem(STORAGE_KEY,JSON.stringify(d));
    const randomId=()=>Math.floor(100000+Math.random()*900000);

    function compute(data){
      data.forEach(t=>{
        t.jogos = (t.vitorias|0) + (t.empates|0) + (t.derrotas|0);
        t.pontos = (t.vitorias|0) * 3 + (t.empates|0);
        t.saldo = (t.gols|0) - (t.sofridos|0);
      });

      data.sort((a,b)=>
        b.pontos-a.pontos ||
        b.vitorias-a.vitorias ||
        b.empates-a.empates ||
        a.derrotas-b.derrotas ||
        b.saldo-a.saldo ||
        b.gols-a.gols
      );

      return data;
    }

    let state={ data:loadData(), selectedId:null };

    function render(){
      state.data=compute(state.data);
      saveData(state.data);
      tbody.innerHTML="";

      state.data.forEach((t,idx)=>{
        const tr=document.createElement("tr");
        tr.dataset.id=t.id;

        if(t.id===state.selectedId) tr.classList.add("selected");
        if(idx<=1) tr.classList.add("top1");
        if(idx>=state.data.length-2) tr.classList.add("bottom2");

        tr.innerHTML=`
          <td>${idx+1}</td>
          <td class="editable" data-field="nome">${t.nome}</td>
          <td>${t.pontos}</td>
          <td>${t.jogos}</td>
          <td class="editable" data-field="vitorias">${t.vitorias}</td>
          <td class="editable" data-field="empates">${t.empates}</td>
          <td class="editable" data-field="derrotas">${t.derrotas}</td>
          <td class="editable" data-field="gols">${t.gols}</td>
          <td class="editable" data-field="sofridos">${t.sofridos ?? 0}</td>
          <td>${t.saldo}</td>
        `;

        tr.onclick=()=>{ state.selectedId=t.id; render(); };

        tr.querySelectorAll(".editable").forEach(td=>{
          td.onclick=e=>{ e.stopPropagation(); edit(td,t.id); };
        });

        tbody.appendChild(tr);
      });
    }

    function edit(td,id){
      const field=td.dataset.field;
      const old=td.textContent.trim();

      td.innerHTML=`<input type="${field==='nome'?'text':'number'}" value="${old}" style="width:100%;font-size:12px;">`;
      const input=td.firstChild;
      input.focus(); input.select();

      input.onblur=()=>{
        const val = field==="nome" ? input.value.trim() : Number(input.value||0);
        const item=state.data.find(t=>t.id===id);
        item[field]=val;
        render();
      };
      input.onkeydown=e=>{
        if(e.key==="Enter") input.blur();
        if(e.key==="Escape") render();
      };
    }

    byId("addBtn").onclick=()=>{
      const id=randomId();
      state.data.push({
        id,
        nome:`Time ${id}`,
        vitorias:0,
        empates:0,
        derrotas:0,
        gols:0,
        sofridos:0
      });
      render();
    };

    byId("delBtn").onclick=()=>{
      if(!state.selectedId) return alert("Selecione um time.");
      if(!confirm("Excluir?")) return;
      state.data=state.data.filter(t=>t.id!==state.selectedId);
      state.selectedId=null;
      render();
    };

    byId("resetPointsBtn").onclick=()=>{
      if(!confirm("Resetar pontos, jogos e gols?")) return;
      state.data=state.data.map(t=>({
        ...t,
        vitorias:0,
        empates:0,
        derrotas:0,
        gols:0,
        sofridos:0
      }));
      render();
    };

    byId("clearBtn").onclick=()=>{
      if(!confirm("Limpar tudo?")) return;
      state.data=[]; state.selectedId=null;
      render();
    };

    /* PDF */
    byId("exportPdfBtn").onclick = () => {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({ orientation:"portrait", unit:"pt", format:"a4" });

      doc.setFillColor(14,165,164);
      doc.rect(0, 0, 600, 70, "F");

      doc.setFont("helvetica", "bold");
      doc.setFontSize(26);
      doc.setTextColor(255,255,255);
      doc.text("CLASSIFICAÇÃO DO CAMPEONATO INTERNO SERIE B", 40, 45);

      const dataHoje = new Date().toLocaleDateString("pt-BR");
      doc.setFontSize(11);
      doc.text(`Gerado em: ${dataHoje}`, 40, 65);

      const body = state.data.map((t, idx) => [
        idx + 1,
        t.nome,
        t.pontos,
        t.jogos,
        t.vitorias,
        t.empates,
        t.derrotas,
        t.gols,
        t.sofridos,
        t.saldo
      ]);

      doc.autoTable({
        startY: 90,
        head: [[ "Pos","Nome","Pts","Jog","Vit","Emp","Der","Gols","Sofr","Sal" ]],
        body: body,
        theme: "striped",
        styles: {
          fontSize: 11,
          cellPadding: 6,
          valign: "middle",
          halign: "center",
        },
        headStyles: {
          fillColor: [15,23,36],
          textColor: [255,255,255],
          fontSize: 12,
        },
        alternateRowStyles: {
          fillColor: [240,240,240],
        },
        columnStyles: {
          1: { halign:"left" }
        },
      });

      doc.setFontSize(10);
      doc.setTextColor(120);
      doc.text("Sistema de Classificação Automática © 2025", 40, doc.lastAutoTable.finalY + 30);

      doc.save("Serie_B.pdf");
    };

    render();
  </script>
</body>
</html>






